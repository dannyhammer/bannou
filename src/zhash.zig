pub const Hash = u64;

const piece_table = [12 * 128]Hash{
    // White Pawn
    0x089666299898B4EE, 0x112CAA7AB13169DC, 0x225932F56262D3B8, 0x442465C35C5D1770, 0x8848ADAF38B29EE1, 0x18913D77F165392F, 0x31221CEFE2C2C6B3, 0x624439DFC585898A, 0, 0, 0, 0, 0, 0, 0, 0,
    0xC41E7396139B1314, 0x80AAE705BFAE9629, 0x09C3CE0B67CD28BE, 0x1311FA3F570A517C, 0x2623927EAE14A2F8, 0x4C4724D4DC21F5F0, 0x981849803843EBE1, 0x38A6F529F087D32F, 0, 0, 0, 0, 0, 0, 0, 0,
    0x714D8C7A799FA2B3, 0xE20D7EF4EBAF418B, 0xCC8CFDC0575637FA, 0x918FFB80AEA4DFF5, 0x2B89F70145D9BB06, 0x5713882B132BC60D, 0xAE271056265788F7, 0x54D846AC4CA7A503, 0, 0, 0, 0, 0, 0, 0, 0,
    0xA926EB711947FEEA, 0x5ADBD6CBB2874DD4, 0xB521CBBEFD9E9BA9, 0x62D5F17DE3AD33BF, 0xC53DE2D25FCA6393, 0x82EDC58D3F94C3CB, 0x0DDB8B1A67B9837B, 0x1B217034CF73021A, 0, 0, 0, 0, 0, 0, 0, 0,
    0x36428669867EB434, 0x6C136AFA946D6869, 0xD826B3F528D2643E, 0xB8DB67C3D1A4C87C, 0x79B6A9AE3BD990F8, 0xF36D3575F7B321F0, 0xEEDA0CEBEF6643E1, 0xD5B419D7C65C832E, 0, 0, 0, 0, 0, 0, 0, 0,
    0xA3FE55AF8CB1B65C, 0x4FFCAB5F01FBDCB9, 0x9F6F56979B6F0D9F, 0x36DEAD06B6D6AFD2, 0x6D2B5A0D6DA5EFA5, 0xDA56B41AC3DBDBA7, 0xBCAD0E3587B7B3A2, 0x71CC7A6B0F67D745, 0, 0, 0, 0, 0, 0, 0, 0,
    0xE30EF4D6065FAA67, 0xCE8BE985942F5023, 0x9581D30B285614AB, 0x2395C03FD0A49DBA, 0x472B805639D93B75, 0x8E570085F3B27207, 0x14AE010BE764E0E3, 0x295C0217CEC1752B, 0, 0, 0, 0, 0, 0, 0, 0,
    0x522E622F851A5EBA, 0xA45CA27692AC0D75, 0x40B922ED2550AE06, 0x817223F3D239EC0C, 0x0AE421E7A473D818, 0x155E43CF48E7B031, 0x2A2AE1B711C7D48F, 0x5455A56E23871DF3, 0, 0, 0, 0, 0, 0, 0, 0,
    // Black Pawn
    0x34B8A3706B4F9984, 0x697120E0CE0F3309, 0xD27441C1848E62FE, 0xACE88383091475FC, 0x51D107060AB8EBF9, 0xA33468259571D31F, 0x4EFED04B2AE3A2D3, 0x9D6BC6BFD5C7414A, 0, 0, 0, 0, 0, 0, 0, 0,
    0x32D78D56331E8294, 0x65397CAC6635B528, 0xCA729F7154FB6A50, 0x9CE53ECB316E64A0, 0x31CA1BBFFA4CC940, 0x6302517FEC099281, 0xC604A2D6581321EE, 0x849F4585302643DD, 0, 0, 0, 0, 0, 0, 0, 0,
    0x01A8ED23F8DC8356, 0x0351BC6E71B1B6AD, 0x063578DCE36369B6, 0x0C6A97B9C6C6D36C, 0x184349738D8516D9, 0x3010F4E7039A295F, 0x60218FE79FACE653, 0xC0431FCF27C9C84A, 0, 0, 0, 0, 0, 0, 0, 0,
    0x88863F9E4F939094, 0x199A7F151F272128, 0x3334982A26DE4250, 0x666930544DB434A1, 0xCC4460811B60DDAE, 0x9088A72BB6C1BB5D, 0x29874E576D837257, 0x530E9C875B06E042, 0, 0, 0, 0, 0, 0, 0, 0,
    0xA61D390EAE9DC084, 0x44AC721D45AB8108, 0x8958823A8B570210, 0x1AB1045C96A6B420, 0x35620890B5DD6841, 0x6A5277216BB2646F, 0xD432EE42CFFC7C32, 0xA0F3DC858768F864, 0, 0, 0, 0, 0, 0, 0, 0,
    0x49E7B90B0ED1F0C9, 0x93597216053B557E, 0x2EB2822C0A76AAFD, 0x5D6504580C7D5116, 0xBA5C6EB0006AA22D, 0x7CB8BB6000D540B6, 0xF97110E9993A816D, 0xFAE221D32AEDB637, 0, 0, 0, 0, 0, 0, 0, 0,
    0xFDC425A64D4B6882, 0xF3882D651A96D104, 0xEF865ACA2DBDA208, 0xD79AD3BDDB73F411, 0xA7A3C17BAE7F5CCE, 0x47D1E4F7446EB99C, 0x8F35C9C7104D7339, 0x16FDF5A7B80AE29E, 0, 0, 0, 0, 0, 0, 0, 0,
    0x2D6DEB4F688D753C, 0x5A4DD69EC98AEA78, 0xB40DCB3D8B8D64F0, 0x608DF07B0F8AC9E1, 0xC11B86F6078D272E, 0x8AA16BEC0F12FE5C, 0x1DD4D7D806BD4CB9, 0x3B3FC9B00D722D9E, 0, 0, 0, 0, 0, 0, 0, 0,
    // White Knight
    0xA83D4ADC47068F0A, 0x58ECF3B88E05AE14, 0xB14FE7589C03EC29, 0x6A9FA8B1209F6CBF, 0xD53F376241366D93, 0xA2E86EC482646FCB, 0x4DD0BBA09C58DB7A, 0x9B377741202906F5, 0, 0, 0, 0, 0, 0, 0, 0,
    0x3EF8EE8240520906, 0x7D67DD0480A4120D, 0xFA59DC2099D820F7, 0xFCB3B8412B28F503, 0xF1F170824EC95EEB, 0xEBE2872D1D92B93B, 0xDFC50E5A23BDC69B, 0xB78A1C9DDFEB89DB, 0, 0, 0, 0, 0, 0, 0, 0,
    0x67825F3BA74FA75B, 0xCF04BE5ED60F4A5B, 0x969F7C94348E905A, 0x25A8F901F18D20B4, 0x4B51942A7B8A4168, 0x96354E7D771482D0, 0x24FCFAFAEE21B5A0, 0x496FF5DC5C436B41, 0, 0, 0, 0, 0, 0, 0, 0,
    0x9249EB913886D26F, 0x2C93B122699DA033, 0x5927046D5333F48A, 0xB24E08DAA667E914, 0x6C9C119CD45FD229, 0xD9382310302FA0BE, 0xBAE64609F8CF417C, 0x7DCC8C13E90E82F9, 0, 0, 0, 0, 0, 0, 0, 0,
    0xFB0F7E27CA8D011E, 0xFE88FC4F8D8A023C, 0xF587F89F038CB478, 0xE399F1179F8968F0, 0xCFA5E206BF12D1E1, 0x97DDC40D66BD172E, 0x27BB881ACD729E5D, 0x4F77101C1AE53856, 0, 0, 0, 0, 0, 0, 0, 0,
    0x9E7846382D5A70AC, 0x34F08C59DAB4E158, 0x69777EB3ADF9C2B1, 0xD278FD4EDBF3818E, 0xACF19CB437E7031D, 0x51E33941F75E02D6, 0xA3507283EEB4B5AD, 0x4EA0832E5D61DFB6, 0, 0, 0, 0, 0, 0, 0, 0,
    0x9D41065CA25B0F6C, 0x32820C90DC2EAED8, 0x650419083855EDB0, 0xCA083210683BDB61, 0x9C8664095077B22E, 0x319AC812A0E7D45C, 0x6335900CD95FA8B8, 0xC66B2019AA2F5170, 0, 0, 0, 0, 0, 0, 0, 0,
    0x84D626334CCEA2E1, 0x01AC2A66810D412E, 0x035832E49A8A825C, 0x062665C92D8DB4B9, 0x0C4CADBBDB13DD9E, 0x180F5B5E3627BB3D, 0x301EB695F4DF7296, 0x603D0B2BE9B6552C, 0, 0, 0, 0, 0, 0, 0, 0,
    // Black Knight
    0x94138F85B4D1A260, 0x20B17922F13BF4C1, 0x4162946C7AEF5D6F, 0x82534EF175D60E33, 0x0CA69DCB733C188B, 0x194D3B96E67085FB, 0x320C77045479BF1A, 0x64188821306BCE35, 0, 0, 0, 0, 0, 0, 0, 0,
    0xC831104260D79886, 0x98F446AD593F310C, 0x39E88D5AAAEE6219, 0x73477CB54D4CC0DF, 0xE618F9431A913553, 0xC4A7F2862DBADE4A, 0x81D9E50C43ED0C94, 0x0BB3AC311F4A1929, 0, 0, 0, 0, 0, 0, 0, 0,
    0x17673E62260C86BE, 0x2E587CC44C11BD7D, 0x5C26F98880BBCE16, 0xB84D953899EF2C2D, 0x789B2A58B3D6ECB7, 0xF13632B167A56D82, 0xEAFA654B57DADB04, 0xDDF4ACBF372D0608, 0, 0, 0, 0, 0, 0, 0, 0,
    0xB3E93F7E6E52BC11, 0x6FD218FCC43DCCCF, 0xDF3257F988732D73, 0xB6F2C9F3087EEE0A, 0x65E593CF90F56C14, 0xCB5D41B6B97AD828, 0x9EBA8344F2F5B050, 0x35E360A07D7B60A1, 0, 0, 0, 0, 0, 0, 0, 0,
    0x6B50C140E26E75AE, 0xD637E4A85C4CEB5D, 0xA4F9C950A009D256, 0x41F39288D88B14AC, 0x8371433831162958, 0x0EE28659FABC52B1, 0x1D536AB3EDE8A18E, 0x3A30D54E5BD1431C, 0, 0, 0, 0, 0, 0, 0, 0,
    0x7461AA9CAF3A3639, 0xE8555510DE74689F, 0xD8AAAA083CE065D3, 0xB9C3541061587F4A, 0x7B86A8095A284E95, 0xF70D363B345099C7, 0xE68C6C5FF0398762, 0xC58ED89678EBBEC4, 0, 0, 0, 0, 0, 0, 0, 0,
    0x838BD72CE94FCD89, 0x0F81C87052972FFF, 0x1F0390C93DBE5B13, 0x3E07219263ECB2CA, 0x7C0E2524C7D1D595, 0xF81C2C60173B1FC7, 0xF8AE58C02E763B62, 0xF9CAD7A9DCE4C6C5, 0, 0, 0, 0, 0, 0, 0, 0,
    0xFB95AF53A1598967, 0xFFBD5E8EDA2BA623, 0xF7ECDB34345748AA, 0xE7D9B641F03E9154, 0xC7B30AAA78ED22A8, 0x87F0737D71D2F550, 0x07E080FAE3A5EAA0, 0x0F5767F5C7436541, 0, 0, 0, 0, 0, 0, 0, 0,
    // White Bishop
    0xC07A1657CBFCAA58, 0x88F42C8617F1E4B1, 0x19E83F25B77B7D8E, 0x33467E4B6EF6FB1D, 0x661AFC96C57DF2D6, 0xCC359F2D8AF355AC, 0x90FD587295E6AB59, 0x29FAB0CCB35D525E, 0, 0, 0, 0, 0, 0, 0, 0,
    0x5363619966B214BD, 0xA650C31B55FC9D96, 0x44A1861F33693B2C, 0x89430C17FE4AC659, 0x1A8618067C95885E, 0x350C300CE1BB10BD, 0x6A1806305BEE9597, 0xD4300C4937D59FC3, 0, 0, 0, 0, 0, 0, 0, 0,
    0xA0F67EBBF73B3B6B, 0x49EC9B77EE76723B, 0x934F50EFC47CE09B, 0x2E9EA1DF88F175DB, 0x5D3D25BF097A5F5A, 0xBA7A2D7E0A6C0EB5, 0x7CF43CFC0C481986, 0xF97E79D19890330C, 0, 0, 0, 0, 0, 0, 0, 0,
    0xFAFC95A329B8D618, 0xFDF92B464BE91C30, 0xF3F230A517D23861, 0xEFE40763B73CC42F, 0xD7C80EC76E713CB3, 0xA7901D8EC47ACD8B, 0x47B65D34106D2FFB, 0x8F6CBA41B84A5B1B, 0, 0, 0, 0, 0, 0, 0, 0,
    0x16D912AAF094B2DB, 0x2D24437C79B9615A, 0x5A4886D17372C2B5, 0xB4076BA2E6E58187, 0x6098D745CDC3B7E2, 0xC131AE8B831FDFC4, 0x8AF55D1706370F89, 0x1DEABA0794FE1BFE, 0, 0, 0, 0, 0, 0, 0, 0,
    0x3B43740F29F487FD, 0x7610E81E4B790B16, 0xEC21B63C8E6AA62D, 0xD0D56C509CD548B6, 0xA9AABEA1213A916C, 0x5BC37D42427522D8, 0xB710FA8484E2F5B0, 0x66B7F50909C5EB60, 0, 0, 0, 0, 0, 0, 0, 0,
    0xCD6F8C3B938366C0, 0x92DF185EBF9E7D81, 0x2DBE3094FF344FEF, 0x5B7C0729E6F89B32, 0xB66E687A55698665, 0x64DCB6F4AAD30826, 0xC92F6DC0D5A6104D, 0x9AC8DB81AB449476, 0, 0, 0, 0, 0, 0, 0, 0,
    0x3D91B7034E1928EC, 0x7B23082F1C3251D9, 0xF646105E20FC175F, 0xE48C2095D9682A53, 0xC18E410232D0504B, 0x8B8AE42DFD38147B, 0x1F83C85BE2E89C1B, 0x3F07909E5D498CDA, 0, 0, 0, 0, 0, 0, 0, 0,
    // Black Bishop
    0xFC54D30E382B8732, 0xF0A9A61C68CFBE64, 0xE9C54C115197CCC8, 0xDB8A980B3BBF9991, 0xBF83563FF77787CE, 0x7790CA7FEEE7BF9C, 0xEF2194D65DC7CF39, 0xD6D54FACA31F9A9E, 0, 0, 0, 0, 0, 0, 0, 0,
    0xA5AA9F594637853D, 0x43C358B28C67BE97, 0x8710D765005F79C2, 0x06B7C8E3982EF385, 0x0D6F91C728CDE3E6, 0x1A4945A7D19377CC, 0x3404ED663BBE5F98, 0x6809BCE5F7740F31, 0, 0, 0, 0, 0, 0, 0, 0,
    0xD0131FE276781A8E, 0xA8B059ED7468851D, 0x59F6D5F37049BED7, 0xB37BCDE6E0937942, 0x6EF79BCDC126F285, 0xDD7951B21ADDE1E7, 0xB2F2A34DB5B37722, 0x6DE520B2F3FE5E45, 0, 0, 0, 0, 0, 0, 0, 0,
    0xDB5C414C7F6CB866, 0xBEB88298E64970CC, 0x75E76331CC92E198, 0xEB58C64A1925C331, 0xDEB18C942ADB828E, 0xB5F57F284D2FB51D, 0x63EA98791A57DED7, 0xC74356F22C3FB943, 0, 0, 0, 0, 0, 0, 0, 0,
    0x8686ADCDD877C66B, 0x059B5B9BA87F883B, 0x0B36B71ED0F7A49B, 0x166D083DA1E7FDDB, 0x2C4C767B43C74F5B, 0x580EECDF1F1E9A5B, 0xB01DBFBE26AD305A, 0x68AD7F55D5CA60B4, 0, 0, 0, 0, 0, 0, 0, 0,
    0xD15A98ABAB94C168, 0xAAB531574FB982D1, 0x5DFC62871F73014F, 0xBB6EC50E267EB672, 0x7EDD8A1C4CF5DCE4, 0xFD2D7238817BB9C9, 0xF2CCE4589A6FC77F, 0xED99AEB12C4F8A12, 0, 0, 0, 0, 0, 0, 0, 0,
    0xD3A55D4BD897A425, 0xAFDCDCBE3127FCA6, 0x57B9B955FADFF94C, 0xAF7314ABED2FF299, 0x56E62957C2CFE1DE, 0xAD5A52861D0FC3BD, 0x52B4A50C228F8397, 0xA5692C31DD8F03C3, 0, 0, 0, 0, 0, 0, 0, 0,
    0x42D23E63A38E036A, 0x85327CC74714B6D4, 0x02F2F98E8E21DDA9, 0x0573F31D04DB0FBE, 0x0A71E613912EAF7D, 0x1475CC0EBACD5A16, 0x287DFE34F592042D, 0x506DFC4073BCBCB7, 0, 0, 0, 0, 0, 0, 0, 0,
    // White Rook
    0x7E0F21153A9319B5, 0xFC1E242A6DBE8787, 0xF0AA4854C3ED0BE2, 0xE9C2F6A987D2A7C4, 0xDB858B7A973DFF88, 0xBF9D70F52E734F11, 0x77ACE1C3DCE69ACE, 0xEF59A5AE39C5859D, 0, 0, 0, 0, 0, 0, 0, 0,
    0xD6B32D75F383BFD6, 0xA5F05AC27F9FCFAD, 0x43E0B584E7AF9BB6, 0x87576B09CF57876C, 0x06AEB03A1EA7BED9, 0x0D5D067425DF795F, 0x1A2C6AE84BB64652, 0x3458B3F917643CA4, 0, 0, 0, 0, 0, 0, 0, 0,
    0x682767DBB6587948, 0xD04EA9B76CB0F290, 0xA89D356EC1F95520, 0x59AC6ADD83F2AA41, 0xB358B3BB07E5506F, 0x6EB101760FC21432, 0xDD6202C59F842864, 0xB2C4058B279850C8, 0, 0, 0, 0, 0, 0, 0, 0,
    0x6D880B164F30A190, 0xDB1016051E614321, 0xBEB64A23BCC282AF, 0x75FAF26EF98501B2, 0xEB63E4DDEB9A0364, 0xDEC7AFBBCFACB6C9, 0xB58F397787C9697F, 0x638872C6970A6612, 0, 0, 0, 0, 0, 0, 0, 0,
    0xC71083A4B68C7C24, 0x86B76160F588F848, 0x05F8C2C1EB11F090, 0x0B67E3AA5623E120, 0x1659C754AC47C241, 0x2C25E8A9401F806E, 0x584BB77B18AF00DD, 0xB0016EDFB156B556, 0, 0, 0, 0, 0, 0, 0, 0,
    0x6894DD96FA3D6AAC, 0xD129BB0474726558, 0xAAC57608E8E4CAB0, 0x5D8A8A3851C12561, 0xBB1514593B1AFE2E, 0x7EBC4EB26EAD4C5D, 0xFD789D4D5D522C57, 0xF2F13A9AA23CEC43, 0, 0, 0, 0, 0, 0, 0, 0,
    0xEDE2133544716C6B, 0xD3C42643107A6C3B, 0xAF882AAFB86C6C9A, 0x5786555F6848D934, 0xAF0CAA975091B268, 0x568F550739BBD4D1, 0xAD1EAA0E6BEF1D4E, 0x52AB541CCF4E3A9C, 0, 0, 0, 0, 0, 0, 0, 0,
    0xA556A8101E94C538, 0x42AD362025B98A70, 0x855A0A69D3EBA4E0, 0x02B414D3A7D749C0, 0x0568298ED73E9380, 0x0A46531DAE759701, 0x141AC03B447B2AEE, 0x2835805F106EE5DC, 0, 0, 0, 0, 0, 0, 0, 0,
    // Black Rook
    0x4221E44CC94434DF, 0x8443AEB01280DD52, 0x00873B602501BAA4, 0x010E10E9D29BC548, 0x021C21D3A5378A90, 0x043825A74A67A521, 0x08702D6714C7FEAE, 0x10765ACE29874D5D, 0, 0, 0, 0, 0, 0, 0, 0,
    0x207AD3B5D3062E56, 0x4063C16BA604ECAC, 0x8051E4FED499D958, 0x08A3AFFDA933B2B0, 0x114739FB4AFFD561, 0x221873DF15F71E2E, 0x443081BE2BE68C5D, 0x88610355D7C5AC56, 0, 0, 0, 0, 0, 0, 0, 0,
    0x18C20682371B58AD, 0x31126B2DF6AE05B6, 0x6224B07275CC0B6C, 0xC44906E4EB90A6D8, 0x80920DC9CFB9FDB0, 0x09B27DBA1F73FB60, 0x13649D74267F46C0, 0x265F5CE84CF63D81, 0, 0, 0, 0, 0, 0, 0, 0,
    0x4C28DFF919E4CFEE, 0x9851BFDBB3C12FDD, 0x38A319B767825B56, 0x71463347579C06AC, 0xE21A668EAF30BD59, 0xCCA2CD1D46F9CE5F, 0x91D3FC3A8DF39853, 0x2BA79E75037F844A, 0, 0, 0, 0, 0, 0, 0, 0,
    0x574F3CC39E6F0894, 0xAE087987244E1129, 0x5486F30E489496BE, 0xA90D803511219D7C, 0x5A8D666A22433AF8, 0xB51AAAFDDC1EC5F1, 0x62A355D238353F0E, 0xC546AB8DF062CE1C, 0, 0, 0, 0, 0, 0, 0, 0,
    0x828D3132785D2C39, 0x0D8C624D70B2EC9F, 0x1B18A2B379FD6DD2, 0x36312366EB6ADBA5, 0x6C6220E456D5B3A6, 0xD85241C8ADA3D74C, 0xB8A4839143DF1E98, 0x79DF612287B68D31, 0, 0, 0, 0, 0, 0, 0, 0,
    0xF328C2450F65AE8E, 0xEEC7E2A39EC3ED1C, 0xD58FA36EBD87DA39, 0xA38946DD639FB09F, 0x4F84EBBAC737D5D3, 0x9F09B1758E671F4A, 0x368562C29CC68E94, 0x6D0AA3ACB985AD29, 0, 0, 0, 0, 0, 0, 0, 0,
    0xDA152170F303EEBE, 0xBCBC42C87E9F6D7D, 0x71EEE3B97D366E16, 0xE34BC75B7A646C2D, 0xCE978E9F74C06CB6, 0x95B97B3EE980D96C, 0x23E4F6545301B2D8, 0x475FEC813E9BD5B1, 0, 0, 0, 0, 0, 0, 0, 0,
    // White Queen
    0x506B0097B84DCBB9, 0xA040672F680B939F, 0x4880A877501723D2, 0x910136EEA026F7A4, 0x2A946DDD40455F48, 0x5528BDBA80820E91, 0xAA511D75010419CE, 0x5CA23AC39A98339D, 0, 0, 0, 0, 0, 0, 0, 0,
    0xB94413AEB53063D7, 0x7A88275D6A60C342, 0xF51028BACC593685, 0xE2B6515C18B269E7, 0xCDFAC4B829FC6722, 0x93F58959D3F07E44, 0x2FEB129A3F784C89, 0x5F40433466682DFE, 0, 0, 0, 0, 0, 0, 0, 0,
    0xBE16E068CCD05BFC, 0x74BBC0D1813807F8, 0xE977818A9AE8BFF0, 0xDAEF03152D49CFE1, 0xBDDE0603DA939B2E, 0x73BC0C07ADBF865D, 0xE778180F43EF0857, 0xC6F0301E87D6A443, 0, 0, 0, 0, 0, 0, 0, 0,
    0x85E0063D0FA5FC6B, 0x03C00C539F434C3B, 0x07167EA7261E2C9A, 0x0E2C9B67D4AC5935, 0x1C5936CFA9500686, 0x38246D9F4A38BD0D, 0x7048BD3E8CE9CEF7, 0xE0077A5499D39902, 0, 0, 0, 0, 0, 0, 0, 0,
    0xC898F480B3A73204, 0x99A7E9016746D409, 0x3BD9D202CE851CFF, 0x7725C22C1D028D13, 0xEE4B8458229DAECB, 0xD4970899DDAB597B, 0xA1B87733A3CE061B, 0x4BE6EE4EDF0C08DA, 0, 0, 0, 0, 0, 0, 0, 0,
    0x975BDC9DA68811B5, 0x26B7B912D5889787, 0x4D6F1425AB112BE3, 0x9A484E62D622532B, 0x3C909CC5AC44A2BB, 0x7921398B4019419B, 0xF242153F18AA37DB, 0xEC842A57B1546B5B, 0, 0, 0, 0, 0, 0, 0, 0,
    0xD19E5486FA38D25B, 0xABAACF247471A05B, 0x5FC3F861707BF45A, 0xBF11F0C2E0F7E8B5, 0x76B5E185C1E76586, 0xED6BA5221B5ECB0C, 0xD2D72C6DB6B52619, 0xADAE3EF2F5FA48DF, 0, 0, 0, 0, 0, 0, 0, 0,
    0x53CA7DCC736C2553, 0xA702FB98E6D0FE4A, 0x4693F71855394C94, 0x8D278830AA729929, 0x12D976614C7D86BF, 0x2524ECC2806B0993, 0x4A49BFAC984EA7CB, 0x94057F59280D4B7A, 0, 0, 0, 0, 0, 0, 0, 0,
    // Black Queen
    0x6C45C5CE4B9AE6D3, 0xD81DEDB51735C94A, 0xB8ADDB43B6FB9294, 0x79CDD0AEF56F9528, 0xF30DC774724F2A50, 0xEE8DE8E8E496E4A1, 0xD58DD1D1C9257DAE, 0xA38DC5A38ADAFB5D, 0, 0, 0, 0, 0, 0, 0, 0,
    0x4F8DED6E95B5F257, 0x9F1BBCF4B3FBE043, 0x36A179C0FF6F746B, 0x6D4295A87ED65C3B, 0xDA134D797DA40C9A, 0xBCB0FCF2E3D81935, 0x71F7F9CC5F288686, 0xE379F398A6C9BD0C, 0, 0, 0, 0, 0, 0, 0, 0,
    0xCEF381314D937A19, 0x95E7024B1B26F0DE, 0x23CE04962EDDE1BC, 0x470A6F2C452BC378, 0x8E14B87112CF36F1, 0x14BF70CBBD0E690F, 0x297E87BEFA1466F3, 0x526B697DECB8C90A, 0, 0, 0, 0, 0, 0, 0, 0,
    0xA440D2D259719215, 0x4081A58D32E320C7, 0x81032D33FD5EF563, 0x0A905A4E7AB55E2B, 0x1520B49CEDFAB8BB, 0x2A410F39C36DC59B, 0x5414787386D33FDB, 0xA82896E70DA67B5A, 0, 0, 0, 0, 0, 0, 0, 0,
    0x58C74BE79B4446B4, 0xB118F1E6B6803D68, 0x6AA7E3CD6D007AD1, 0xD54FA1B35A00F14F, 0xA29F2566AC995672, 0x4DA84ACD41AA1CE4, 0x9B50959A835439C8, 0x3EA12B1C9E387390, 0, 0, 0, 0, 0, 0, 0, 0,
    0x7D42303924E85720, 0xFA12605BD1481E40, 0xFCB2C09E3A088C81, 0xF1F3E73C6C89ADEF, 0xEBE7A878C18BEF33, 0xDFCF36F18317DA8A, 0xB79E0BE306270514, 0x67AA71EF94DE0A29, 0, 0, 0, 0, 0, 0, 0, 0,
    0xCF5485F6B12C10BE, 0x96A90BC4FAC8217C, 0x25C471A0759042F9, 0x4B1EE340EB20811E, 0x963DA0A85641023D, 0x24ED4150AC820097, 0x494CE4A1419CB5C3, 0x920FC9428331DF6A, 0, 0, 0, 0, 0, 0, 0, 0,
    0x2C89F4AC9EFB0ED5, 0x59138F70BDF61947, 0xB2271EC8FBE48662, 0x6CD85BB877C1BCC4, 0xD926D170EF837989, 0xBADBC4E1C79E47FE, 0x7DB789C38F343FFD, 0xFB6F138706F87B17, 0, 0, 0, 0, 0, 0, 0, 0,
    // White King
    0x209CFE9BD01226F5, 0x41399B37A0244906, 0x82733646D8D8920D, 0x0CE60AA431B120F7, 0x195A7361FBFAF503, 0x3222E6C3EF6D5EEA, 0x6445ABAE5ED20DD5, 0xC81D575CA53CAF46, 0, 0, 0, 0, 0, 0, 0, 0,
    0x98ACC8B94A71EE8C, 0x39CFF7728C7B6D18, 0x7309EECC98F6DA30, 0xE613BBB0B1E50460, 0xC4B17748FB5A08C1, 0x81F4EE91EE2CA56E, 0x0BE9BB23C4C94ADD, 0x1745764789929157, 0, 0, 0, 0, 0, 0, 0, 0,
    0x2E1CEC8F0BBD9642, 0x5C39BF3797739C84, 0xB873186F2EE73908, 0x78E630DE455E7211, 0xF15A6195122CE0CF, 0xEAB4A52A24517572, 0xDDFF4A5448A2EAE5, 0xB3FE94811145D127, 0, 0, 0, 0, 0, 0, 0, 0,
    0x6FFD2902228316A3, 0xDF6C5204450629AB, 0xB6D8A4088A04E7BA, 0x65B12E3894017F75, 0xCB623A712802FA06, 0x9EC412E2489D440C, 0x358825C489AA8818, 0x6B102DA093551030, 0, 0, 0, 0, 0, 0, 0, 0,
    0xD6203D68BE3A2061, 0xA4D67AD164ECF42F, 0x41AC93A2C9D15CB3, 0x835927458B3A0D8A, 0x0EB228A296741B15, 0x1D64376CB47832C7, 0x3A5E6ED968F06162, 0x742ADD9B51E0C2C4, 0, 0, 0, 0, 0, 0, 0, 0,
    0xE855BB1F3B593589, 0xD8AB103E6E2ADFFE, 0xB9C0467CC4CD0FFD, 0x7B808CD0110A1B16, 0xF7011989BA8C862C, 0xE694553AF511BC58, 0xC5BECC75EA2378B1, 0x83EBFEEBCCDE458F, 0, 0, 0, 0, 0, 0, 0, 0,
    0x0FD79BFE19B43FF3, 0x1F3951FC2BF87B0B, 0x3E72A3D1D7F0F2FA, 0x7C73478A377955F5, 0xF870E93DF66A1F07, 0xF8E1B47BECD43AE3, 0xF9C30EF7C138712B, 0xFB861DC61AE856BB, 0, 0, 0, 0, 0, 0, 0, 0,
    0xFF9A5DA5B5D0A99B, 0xF7A2DD62F339E7DA, 0xE7D3DCEC7EEB7FB4, 0xC7A7B9D8E54E4F69, 0x87D97398520C9A3E, 0x07B28130A411847D, 0x0F650248D0BBBC17, 0x1E5C62B839EFCCC3, 0, 0, 0, 0, 0, 0, 0, 0,
    // Black King
    0x1CB23BC223C50B9F, 0x396411ADDF1A13D3, 0x725E45723E34234B, 0xE42AECE464F8427B, 0xC0C3D9C8C9F0801B, 0x8987B3918B79B4DA, 0x1B99670A96F369B5, 0x3732A83CB57E6786, 0, 0, 0, 0, 0, 0, 0, 0,
    0x6E6536796AF47F0C, 0xDC5C6CDB55E04E19, 0xB0B8BFB6ABC098DE, 0x69E77F44D78131BC, 0xD358FE89AF026379, 0xAEB19B3ADE04C21F, 0x55F55075A49980D2, 0xAB7CC6EB493301A5, 0, 0, 0, 0, 0, 0, 0, 0,
    0x5EF98DD68AFEB7A7, 0xBD657DAD0D6D6BA2, 0x72CA9D739AD26744, 0xE5035CE72D3C7E88, 0xC290DFE7DA704D10, 0x8DB7D9E634E09A20, 0x13F9D5E5F1598441, 0x2765CDE27A2BBC6E, 0, 0, 0, 0, 0, 0, 0, 0,
    0x4E5DFDED745778DD, 0x9C2DFBDAE8A64557, 0x30CDF79C51443E43, 0x610DEF113A18786B, 0xC21BB8226CA8443B, 0x8CA17044C1C83C9A, 0x11D4E08983907934, 0x233FC1130720F268, 0, 0, 0, 0, 0, 0, 0, 0,
    0x467F820F96D954D1, 0x8C696236B52A1D4E, 0x10D2A26D6A543A9D, 0x213344DACC3871D6, 0x4266899C1870E3AC, 0x845B753828797758, 0x00B68C70486A5EB1, 0x016D18C910D4B98E, 0, 0, 0, 0, 0, 0, 0, 0,
    0x024C57BBB939731C, 0x040EC9776AEA5639, 0x081D92C755D4A89F, 0x103B258EABA1E5D2, 0x20762D34D743CBA4, 0x407A5A40361F2749, 0x8062D2A9F4AE4A7E, 0x08C5A553E95424FD, 0, 0, 0, 0, 0, 0, 0, 0,
    0x111D4A8E52A0FD16, 0x223A951CA541FA2C, 0x44752A10D21B4459, 0x887C54083CAE3C5E, 0x18F8A81061CC78BC, 0x316750095B08F178, 0x6258C63B3611E2F1, 0xC427EA766C23C10E, 0, 0, 0, 0, 0, 0, 0, 0,
    0x80D9D4C55847821D, 0x09B3A98AA81F00D7, 0x1367353CD036B542, 0x26586A5038FD6A84, 0x4C26D489F1F26508, 0x984DA913E3E4CA10, 0x389B3427C7C12421, 0x71360E66171AFCAE, 0, 0, 0, 0, 0, 0, 0, 0,
};

const enpassant_table = [16]Hash{
    0xDE42D995DDE2D436, 0xB485B3023BC5A86C, 0x619D66046F1B50D8, 0xC33AAA215E36A1B0, 0x8EE35442A4FD4360, 0x15C6A88549F236C0, 0x2B1B510A8B7CDD80, 0x5636A2150E69BB00, 0, 0, 0, 0, 0, 0, 0, 0,
};

const base_castle_table = [4]Hash{
    0xAC6D222A044BC600,
    0x50DA227D900F3C00,
    0xA12244D2B88E7800,
    0x4AD2EFA5698CF000,
};

pub const move: Hash = 0x9533DF4ACB89E000;

const castle_table = blk: {
    var ct: [0b1_000_000]Hash = undefined;
    for (&ct, 0..) |*h, i| {
        h.* = 0;
        if (i & 0b110_000 == 0b110_000) h.* ^= base_castle_table[0];
        if (i & 0b011_000 == 0b011_000) h.* ^= base_castle_table[1];
        if (i & 0b000_110 == 0b000_110) h.* ^= base_castle_table[2];
        if (i & 0b000_011 == 0b000_011) h.* ^= base_castle_table[3];
    }
    break :blk ct;
};

pub fn enpassant(where: u8) Hash {
    return enpassant_table[where & 0xF];
}

pub fn piece(color: Color, ptype: PieceType, where: u8) Hash {
    const index = @as(usize, @intFromEnum(ptype) - 1) << 8 | @as(usize, @intFromEnum(color)) << 7 | @as(usize, where);
    assert(piece_table[index] != 0);
    return piece_table[index];
}

fn castleIndex(c: u64) usize {
    const x = (c & castle_mask.any) *% 0x25;
    const lower = (x >> 5) & 0x07;
    const upper = (x >> 58) & 0x38;
    return upper | lower;
}

pub fn castle(c: u64) Hash {
    return castle_table[castleIndex(c)];
}

test castleIndex {
    try std.testing.expectEqual(0, castleIndex(0));
    try std.testing.expectEqual(0b000_110, castleIndex(castle_mask.wk));
    try std.testing.expectEqual(0b000_011, castleIndex(castle_mask.wq));
    try std.testing.expectEqual(0b110_000, castleIndex(castle_mask.bk));
    try std.testing.expectEqual(0b011_000, castleIndex(castle_mask.bq));
}

const std = @import("std");
const assert = std.debug.assert;
const castle_mask = @import("castle_mask.zig");
const Color = @import("common.zig").Color;
const PieceType = @import("common.zig").PieceType;
